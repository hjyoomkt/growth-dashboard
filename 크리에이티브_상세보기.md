# 크리에이티브 상세보기 모달 구현

## 구현 목표
/admin/default 페이지의 "조회기간 BEST 소재" 및 "광고 크리에이티브" 섹션에 상세보기 모달 추가

## 모달 구성
- **왼쪽**: 이미지 or 동영상
- **오른쪽 상단**: 혼합 차트 (막대 + 꺾은선)
  - 지표 선택 드롭다운 2개
  - 기본값: 노출(막대) + CTR(꺾은선)
  - 선택 가능 지표: 노출, 클릭, CTR, ROAS, 지출금액, 전환수
- **오른쪽 하단**: 일자별 성과 테이블

## 생성된 파일 (3개)

### 1. CreativeDetailModal.jsx
- 경로: `src/views/admin/default/components/CreativeDetailModal.jsx`
- 역할: 메인 모달 컨테이너, 데이터 fetch, 레이아웃
- 크기: size='4xl', maxW='70vw', maxH='85vh'
- Props: `isOpen`, `onClose`, `creative` (ad_id, adName, imageUrl, videoUrl, isVideo, media)
- 데이터 fetch: `getAdDailyPerformance()` 호출

### 2. MixedMetricChart.jsx
- 경로: `src/views/admin/default/components/MixedMetricChart.jsx`
- 역할: ApexCharts 혼합 차트 (막대 + 꺾은선)
- 차트 높이: 250px
- 막대 두께: columnWidth='16px'
- Props: `dailyData`, `metric1`, `metric2`, `onMetric1Change`, `onMetric2Change`

### 3. DailyPerformanceTable.jsx
- 경로: `src/views/admin/default/components/DailyPerformanceTable.jsx`
- 역할: 일자별 성과 테이블 (스크롤 가능)
- 테이블 높이: maxH='300px'
- 컬럼: 날짜, 노출, 클릭, CTR, 지출금액, 전환수, ROAS

## 수정된 파일 (3개)

### 1. supabaseService.js
- 경로: `src/services/supabaseService.js`
- 수정 내용:
  - `getBestCreatives()`: 반환 객체에 `ad_id` 추가
  - `getAllCreatives()`: 반환 객체에 `ad_id` 추가
  - `getAdDailyPerformance(adId, startDate, endDate)`: 신규 함수 추가
    - 특정 광고의 일별 성과 조회
    - 날짜별 집계 수행
    - CTR, ROAS 계산

### 2. BestCreatives.js
- 경로: `src/views/admin/default/components/BestCreatives.js`
- 수정 내용:
  - `useDisclosure` import 추가
  - `CreativeDetailModal` import 추가
  - `CreativeCard` 컴포넌트에 모달 state 추가
  - "상세보기" 버튼에 `onClick={onOpen}` 추가
  - 모달 컴포넌트 렌더링

### 3. AllCreatives.js
- 경로: `src/views/admin/default/components/AllCreatives.js`
- 수정 내용: BestCreatives.js와 동일

## 데이터 흐름

1. 사용자가 "상세보기" 버튼 클릭
2. CreativeDetailModal 열림
3. `getAdDailyPerformance(ad_id, startDate, endDate)` 호출
4. ad_performance 테이블에서 일별 데이터 조회 및 집계
5. CTR, ROAS 계산
6. 차트 및 테이블에 데이터 표시

## 데이터베이스

### 사용 테이블
- `ad_performance`: 일별 광고 성과 데이터
  - 컬럼: date, ad_id, source, cost, impressions, clicks, conversions, conversion_value
- `ad_creatives`: 크리에이티브 정보
  - 컬럼: ad_id, ad_name, url, creative_type

### 계산 로직
- CTR = (clicks / impressions) × 100
- ROAS = (conversion_value / cost) × 100

## 차트 설정

### 지표 구성 (METRICS)
```
impressions: 노출 (막대, #4318FF)
clicks: 클릭 (막대, #6AD2FF)
ctr: CTR (꺾은선, #01B574, %)
roas: ROAS (꺾은선, #FFB547, %)
cost: 지출금액 (막대, #E31A1A)
conversions: 전환수 (막대, #39B68D)
```

## 스타일 설정

- 모달 크기: 4xl (maxW='70vw', maxH='85vh')
- 차트 높이: 250px
- 테이블 높이: 300px (스크롤)
- 막대 두께: 16px
- 패딩: 16px (Card)
- 간격: 16px (Grid, Flex gap)

## 수정 시 참고 파일

### 모달 패턴
- `src/views/shared/board/components/ViewPostModal.jsx`

### 차트 패턴
- `src/views/admin/default/components/TotalSpent.js`
- `src/components/charts/LineChart.js`
- `src/components/charts/BarChart.js`

### Context
- `src/contexts/DateRangeContext.js`: startDate, endDate
- `src/contexts/AuthContext.js`: currentAdvertiserId

## 주의사항

1. **ad_id 필수**: creative 객체에 ad_id가 반드시 포함되어야 함
2. **날짜 범위**: startDate, endDate는 DateRangeContext에서 가져옴
3. **React Hooks 규칙**: useColorModeValue는 컴포넌트 최상위에서만 호출
4. **데이터 집계**: 동일 날짜에 여러 행이 있을 수 있으므로 날짜별 집계 필요
5. **0으로 나누기 방지**: CTR, ROAS 계산 시 분모가 0인지 확인

## 테스트 방법

1. /admin/default 페이지 접속
2. "조회기간 BEST 소재" 또는 "광고 크리에이티브" 카드에서 "상세보기" 클릭
3. 모달 확인:
   - 왼쪽: 이미지/동영상 표시
   - 오른쪽 상단: 혼합 차트 (기본값: 노출 + CTR)
   - 지표 드롭다운으로 변경 가능
   - 오른쪽 하단: 일자별 성과 테이블

## 향후 개선 사항

- 테이블 페이지네이션 추가 (현재는 스크롤만 지원)
- 차트 데이터 엑셀 다운로드 기능
- 기간 비교 기능 (전주 대비, 전월 대비)
