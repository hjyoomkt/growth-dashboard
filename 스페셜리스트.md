# Specialist 직급 구현 문서

## 개요

기존 8단계 직급 체계(master~viewer)와 독립된 **Specialist** 직급을 추가 구현

**구현 날짜**: 2026-01-29

---

## 요구사항

### 1. 독립성
- 기존 직급 체계(master, agency_admin, agency_manager, agency_staff, advertiser_admin, advertiser_staff, editor, viewer)와 독립된 별도 직급
- Role Hierarchy: `specialist: 50` (master:100 다음 순위)

### 2. 조직 접근 권한
- Master와 동일하게 **모든 조직/광고주 데이터** 조회 가능
- 브랜드 선택 드롭다운에 모든 브랜드 표시

### 3. 페이지 접근 제한
- **허용 페이지**: `/admin/default`, `/admin/data-tables`만 접근 가능
- **차단 페이지**: 그 외 모든 페이지 (`/admin/profile`, `/admin/roas-analyzer`, `/superadmin/*`, `/brandadmin/*` 등)
- 차단된 페이지 접근 시 `/admin/default`로 자동 리다이렉트

### 4. UI 제한
- **알림 숨김**: 상단 navbar의 알림 벨 아이콘 완전 비표시
- **사이드바**: "Main Dashboard", "Data Tables" 2개 메뉴만 표시

---

## 수정된 파일 목록

### 1. `src/services/supabaseService.js`

**수정 내용**:
- roleHierarchy에 `specialist: 50` 추가 (3곳)
- getAvailableAdvertisers 함수에서 specialist 처리

```javascript
// roleHierarchy 수정 (line ~613, 683, 734)
const roleHierarchy = {
  master: 100,
  specialist: 50,  // 신규 추가
  agency_admin: 7,
  agency_manager: 6,
  agency_staff: 5,
  advertiser_admin: 4,
  advertiser_staff: 3,
  editor: 2,
  viewer: 1,
};

// getAvailableAdvertisers 수정 (line ~148)
if (userData.role === 'master' || userData.role === 'specialist') {
  // Master & Specialist: 모든 광고주
  const { data, error } = await supabase.from('advertisers').select('*');
  console.log('[getAvailableAdvertisers] 조회 성공 (master/specialist):', { count: data?.length });
  return data || [];
}
```

---

### 2. `src/contexts/AuthContext.js`

**수정 내용**:
- isSpecialist() 헬퍼 함수 추가
- 게시판 알림 fetch 시 specialist 제외
- value 객체에 isSpecialist 추가

```javascript
// line ~303
const isMaster = () => role === 'master';
const isSpecialist = () => role === 'specialist';

// line ~115 - 게시판 알림 자동 로드
const fetchBoardNotifications = async () => {
  // Specialist는 알림을 표시하지 않음
  if (!user || !role || !availableAdvertisers || role === 'specialist') return;
  // ...
};

// value 객체 (line ~435)
const value = {
  // ...
  isMaster,
  isSpecialist,  // 신규 추가
  isOrgAdmin,
  // ...
};
```

---

### 3. `src/layouts/admin/index.js`

**수정 내용**:
- Specialist 페이지 접근 제한 로직 추가
- getRoutes 함수에서 specialist 라우트 필터링

```javascript
// line ~16
const { user, loading, role } = useAuth();
const location = useLocation();

// Specialist 페이지 접근 제한
const isSpecialist = role === 'specialist';
const allowedSpecialistPaths = ['/admin/default', '/admin/data-tables'];

// line ~38 - 허용된 경로 외 리다이렉트
if (isSpecialist && !allowedSpecialistPaths.includes(location.pathname)) {
  return <Navigate to="/admin/default" replace />;
}

// line ~110 - getRoutes 함수 수정
const getRoutes = (routes) => {
  return routes.map((route, key) => {
    if (route.layout === '/admin') {
      // Specialist는 특정 라우트만 접근 가능
      if (isSpecialist && route.path !== '/default' && route.path !== '/data-tables') {
        return null;
      }
      return <Route path={`${route.path}`} element={route.component} key={key} />;
    }
    // ...
  });
};
```

---

### 4. `src/components/sidebar/components/Links.js`

**수정 내용**:
- isSpecialist를 useAuth에서 가져오기
- createLinks 함수에서 specialist 메뉴 필터링

```javascript
// line ~21
const {
  role,
  organizationType,
  isMaster,
  isSpecialist,  // 신규 추가
  canAccessSuperAdmin,
  canAccessBrandAdmin
} = useAuth();

// line ~65 - createLinks 내부
// ✅ Specialist는 /admin/default, /admin/data-tables만 표시
if (isSpecialist && isSpecialist()) {
  if (route.layout !== '/admin' || (route.path !== '/default' && route.path !== '/data-tables')) {
    return null;
  }
}
```

---

### 5. `src/components/navbar/NavbarLinksAdmin.js`

**수정 내용**:
- getRoleKorean에 specialist 추가
- shouldShowBrandSelector에 specialist 추가
- 알림 메뉴를 specialist에서 숨김

```javascript
// line ~54 - getRoleKorean
const getRoleKorean = (role) => {
  const roleMap = {
    'master': '마스터',
    'specialist': '스페셜리스트',  // 신규 추가
    'agency_admin': '에이전시 대표',
    // ...
  };
  return roleMap[role] || role;
};

// line ~72 - 브랜드 선택 드롭다운 표시 여부
const shouldShowBrandSelector =
  role === 'master' ||
  role === 'specialist' ||  // 신규 추가
  role === 'agency_admin' ||
  // ...

// line ~285 - 알림 메뉴 조건부 렌더링
{/* 알림 메뉴 - Specialist는 표시하지 않음 */}
{role !== 'specialist' && (
  <Menu>
    <MenuButton p="0px" position="relative">
      <Icon as={MdNotificationsNone} ... />
      {/* ... */}
    </MenuButton>
    <MenuList>
      {/* 알림 목록 */}
    </MenuList>
  </Menu>
)}
```

---

### 6. `src/layouts/superadmin/index.js`

**수정 내용**:
- canAccessSuperAdmin 함수에서 specialist 명시적 차단

```javascript
// line ~33
const canAccessSuperAdmin = () => {
  if (role === 'specialist') return false;
  return ['master', 'agency_admin', 'agency_manager'].includes(role);
};
```

---

### 7. `src/layouts/clientadmin/index.js`

**수정 내용**:
- canAccessClientAdmin 함수에서 specialist 명시적 차단

```javascript
// line ~33
const canAccessClientAdmin = () => {
  if (role === 'specialist') return false;
  return ['master', 'advertiser_admin', 'advertiser_staff', 'manager'].includes(role);
};
```

---

### 8. `src/views/superadmin/permissions/components/PermissionTable.js`

**수정 내용**:
- getRoleLabel에 specialist 추가

```javascript
// line ~221
const getRoleLabel = (role) => {
  const roleMap = {
    master: '마스터',
    specialist: '스페셜리스트',  // 신규 추가
    agency_admin: '에이전시 대표',
    // ...
  };
  return roleMap[role] || role;
};
```

---

## Specialist 직급 특징 정리

| 항목 | 내용 |
|------|------|
| **Role 이름** | `specialist` |
| **Role 레벨** | 50 (master:100 다음) |
| **한글 표시명** | 스페셜리스트 |
| **조직 접근** | 모든 조직/광고주 데이터 조회 가능 (master와 동일) |
| **허용 페이지** | `/admin/default`, `/admin/data-tables` |
| **차단 페이지** | `/admin/profile`, `/admin/roas-analyzer`, `/superadmin/*`, `/brandadmin/*` 등 |
| **사이드바 메뉴** | Main Dashboard, Data Tables 2개만 표시 |
| **알림 표시** | 완전 숨김 (알림 벨 아이콘 비표시) |
| **브랜드 선택** | 가능 (모든 브랜드 표시) |

---

## 데이터베이스 설정

### users 테이블 role 컬럼 수정

Specialist 역할을 허용하도록 제약조건 수정 필요:

```sql
-- role 컬럼에 'specialist' 값 허용
ALTER TABLE users
DROP CONSTRAINT IF EXISTS users_role_check;

ALTER TABLE users
ADD CONSTRAINT users_role_check
CHECK (role IN (
  'master',
  'specialist',  -- 신규 추가
  'agency_admin',
  'agency_manager',
  'agency_staff',
  'advertiser_admin',
  'advertiser_staff',
  'editor',
  'viewer'
));
```

### Specialist 계정 생성 방법

1. **Supabase Dashboard → Authentication → Users**에서 이메일/비밀번호로 계정 생성
2. **SQL Editor**에서 users 테이블 레코드 생성:

```sql
-- users 테이블에 specialist 레코드 생성
INSERT INTO users (
  id,
  email,
  name,
  role,
  status,
  organization_id,
  advertiser_id,
  created_at,
  updated_at
)
SELECT
  au.id,
  '계정이메일',
  '이름',
  'specialist',
  'active',
  NULL,
  NULL,
  NOW(),
  NOW()
FROM auth.users au
WHERE au.email = '계정이메일'
ON CONFLICT (id)
DO UPDATE SET
  name = '이름',
  role = 'specialist',
  status = 'active',
  organization_id = NULL,
  advertiser_id = NULL,
  updated_at = NOW();
```

---

## 테스트 체크리스트

### 기본 기능
- [x] Specialist로 로그인 성공
- [x] 프로필 드롭다운에 "스페셜리스트" 표시

### 조직/브랜드 접근
- [x] 브랜드 선택 드롭다운 표시
- [x] 모든 조직/광고주가 드롭다운에 표시됨
- [x] 브랜드 전환 가능

### 페이지 접근
- [x] `/admin/default` 접근 가능
- [x] `/admin/data-tables` 접근 가능
- [x] `/admin/profile` 접근 시 `/admin/default`로 리다이렉트
- [x] `/admin/roas-analyzer` 접근 시 리다이렉트
- [x] `/superadmin/*` 접근 시 리다이렉트
- [x] `/brandadmin/*` 접근 시 리다이렉트

### UI 제한
- [x] 사이드바에 "Main Dashboard", "Data Tables"만 표시
- [x] 상단 알림 벨 아이콘 미표시
- [x] 알림 fetch 제외 (네트워크 요청 없음)

---

## 주의사항

1. **독립성 유지**: Specialist는 기존 직급 체계와 독립적으로 동작하므로, 향후 권한 관련 로직 추가 시 specialist도 고려해야 함

2. **알림 시스템**: Specialist는 알림을 표시하지 않으므로, 중요한 공지사항은 별도 채널로 전달 필요

3. **페이지 추가**: 새로운 `/admin/*` 페이지 추가 시, Specialist 접근 제한을 AdminLayout의 `allowedSpecialistPaths`에 반영 필요

4. **Role Hierarchy**: Specialist(50)는 master(100) 다음 순위이므로, master만 specialist 계정 편집 가능

---

## 구현 완료 날짜

**2026-01-29**

구현: Claude Code Agent
문서 작성: 2026-01-29
