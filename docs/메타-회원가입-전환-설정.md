# ë©”íƒ€ íšŒì›ê°€ì… ì „í™˜ ì„¤ì • êµ¬í˜„ ì™„ë£Œ

**ì‘ì—… ì¼ì**: 2026-01-25
**ì‘ì—…ì**: Claude Code
**ëª©ì **: ê´‘ê³ ì£¼ë³„ë¡œ ë©”íƒ€ ê´‘ê³ ì˜ ì „í™˜ ì§€í‘œë¥¼ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •

---

## ğŸ“‹ ê°œìš”

### ë°°ê²½
ì¼ë¶€ ê´‘ê³ ì£¼ëŠ” íšŒì›ê°€ì…ì„ ì „í™˜ ëª©í‘œë¡œ ì„¤ì •í•˜ì§€ë§Œ, ë©”íƒ€ ê´‘ê³ ì—ì„œ êµ¬ë§¤(conversions)ê°€ 0ìœ¼ë¡œ í‘œì‹œë˜ì–´ ëŒ€ì‹œë³´ë“œì— ì „í™˜ìˆ˜ê°€ 0ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

ì‹¤ì œë¡œëŠ” `complete_registrations` í•„ë“œì— íšŒì›ê°€ì… ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ê³  ìˆì—ˆìœ¼ë‚˜, ëŒ€ì‹œë³´ë“œëŠ” í•­ìƒ `conversions` í•„ë“œë§Œ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

### í•´ê²° ë°©ì•ˆ
ê´‘ê³ ì£¼ë³„ë¡œ ë©”íƒ€ ì „í™˜ ì§€í‘œë¥¼ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ì„¤ì • ê¸°ëŠ¥ì„ ì¶”ê°€:
- **êµ¬ë§¤** (conversions, conversion_value) - ê¸°ë³¸ê°’
- **íšŒì›ê°€ì…** (complete_registrations, complete_registrations_value)

### ì ìš© ë²”ìœ„
- `/admin/default` - ë©”ì¸ ëŒ€ì‹œë³´ë“œ (KPI, ì°¨íŠ¸)
- `/admin/data-tables` - ë°ì´í„° í…Œì´ë¸” (ë§¤ì²´ë³„/ìº í˜ì¸ë³„/ì¼ë³„/ì£¼ë³„/ì›”ë³„ ìš”ì•½)
- `/superadmin/advertisers` - ê´‘ê³ ì£¼ ì„¤ì • UI

### í•µì‹¬ ì›ì¹™
1. **ë©”íƒ€ ê´‘ê³ ë§Œ ì ìš©**: Google Ads, Naver, KakaoëŠ” ê¸°ì¡´ëŒ€ë¡œ conversions ì‚¬ìš©
2. **ë§¤ì²´ê°„ í•©ì‚°**: ë©”íƒ€(ì„¤ì •ê°’) + íƒ€ë§¤ì²´(conversions) = ì´ ì „í™˜ìˆ˜
3. **ê¸°ì¡´ íŒ¨í„´ ìœ ì§€**: ìµœì†Œ ë³€ê²½ìœ¼ë¡œ êµ¬í˜„

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

**íŒŒì¼**: [`database/migrations/add_meta_conversion_type.sql`](database/migrations/add_meta_conversion_type.sql)

```sql
-- advertisers í…Œì´ë¸”ì— meta_conversion_type ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE advertisers
ADD COLUMN IF NOT EXISTS meta_conversion_type TEXT DEFAULT 'purchase';

-- ì œì•½ì¡°ê±´: 'purchase' ë˜ëŠ” 'complete_registration'ë§Œ í—ˆìš©
ALTER TABLE advertisers
ADD CONSTRAINT check_meta_conversion_type
CHECK (meta_conversion_type IN ('purchase', 'complete_registration'));

-- ì£¼ì„ ì¶”ê°€
COMMENT ON COLUMN advertisers.meta_conversion_type IS 'ë©”íƒ€ ê´‘ê³  ì „í™˜ ì§€í‘œ íƒ€ì… (purchase: êµ¬ë§¤, complete_registration: íšŒì›ê°€ì…)';

-- ê¸°ì¡´ ë°ì´í„° ê¸°ë³¸ê°’ ì„¤ì • (ëª¨ë‘ êµ¬ë§¤ë¡œ ì´ˆê¸°í™”)
UPDATE advertisers
SET meta_conversion_type = 'purchase'
WHERE meta_conversion_type IS NULL;
```

**ê²°ê³¼**: âœ… ì‹¤í–‰ ì™„ë£Œ

---

### 2. ê´‘ê³ ì£¼ ì„¤ì • UI

#### ìˆ˜ì • íŒŒì¼
1. **[EditBrandModal.jsx](src/views/superadmin/advertisers/components/EditBrandModal.jsx)**
   - ë©”íƒ€ ì „í™˜ ì„¤ì • ë“œë¡­ë‹¤ìš´ ì¶”ê°€
   - formDataì— `metaConversionType` í•„ë“œ ì¶”ê°€
   - DB ì €ì¥ ë¡œì§ ì¶”ê°€

2. **[index.jsx](src/views/superadmin/advertisers/index.jsx)**
   - ê´‘ê³ ì£¼ ì¡°íšŒ ì‹œ `meta_conversion_type` í•„ë“œ ì¶”ê°€

#### ì£¼ìš” ë³€ê²½ì‚¬í•­

**formData ì¶”ê°€**:
```javascript
const [formData, setFormData] = useState({
  name: "",
  businessNumber: "",
  contactEmail: "",
  contactPhone: "",
  metaConversionType: "purchase", // ì¶”ê°€
});
```

**UI ì»´í¬ë„ŒíŠ¸**:
```jsx
{/* ë©”íƒ€ ì „í™˜ ì„¤ì • */}
<FormControl>
  <FormLabel>ë©”íƒ€ ì „í™˜ ì„¤ì •</FormLabel>
  <Menu>
    <MenuButton as={Button}>
      {formData.metaConversionType === 'purchase'
        ? 'êµ¬ë§¤ (conversions)'
        : 'íšŒì›ê°€ì… (ë“±ë¡ì™„ë£Œ)'}
    </MenuButton>
    <MenuList>
      <MenuItem onClick={() => setFormData({ ...formData, metaConversionType: 'purchase' })}>
        êµ¬ë§¤ (conversions)
      </MenuItem>
      <MenuItem onClick={() => setFormData({ ...formData, metaConversionType: 'complete_registration' })}>
        íšŒì›ê°€ì… (ë“±ë¡ì™„ë£Œ)
      </MenuItem>
    </MenuList>
  </Menu>
</FormControl>
```

**ê²°ê³¼**: âœ… UI ì¶”ê°€ ì™„ë£Œ

---

### 3. ì„œë¹„ìŠ¤ í•¨ìˆ˜ ìˆ˜ì • (10ê°œ)

**íŒŒì¼**: [`src/services/supabaseService.js`](src/services/supabaseService.js)

#### ìˆ˜ì •ëœ í•¨ìˆ˜ ëª©ë¡

| ë²ˆí˜¸ | í•¨ìˆ˜ëª… | ë¼ì¸ | ì„¤ëª… |
|-----|--------|------|------|
| 1 | `getKPIData()` | 956 | KPI ë°ì´í„° (ì „í™˜ìˆ˜, CVR, ROAS) |
| 2 | `getWeeklyConversions()` | 829 | ìš”ì¼ë³„ ì „í™˜ìˆ˜ ì°¨íŠ¸ |
| 3 | `getMediaAdSummary()` | 1237 | ë§¤ì²´ë³„ ê´‘ê³  ìš”ì•½ í…Œì´ë¸” |
| 4 | `getCampaignAdSummary()` | 1321 | ìº í˜ì¸ë³„ ìš”ì•½ |
| 5 | `getDailyAdSummary()` | 1406 | ì¼ë³„ ìš”ì•½ |
| 6 | `getWeeklyAdSummary()` | 1490 | ì£¼ë³„ ìš”ì•½ |
| 7 | `getMonthlyAdSummary()` | 1558 | ì›”ë³„ ìš”ì•½ |
| 8 | `getDailyROASAndCost()` | 1736 | ROAS & ê´‘ê³ ë¹„ ë¶„ì„ |
| 9 | `getBestCreatives()` | 1808 | ìƒìœ„ í¬ë¦¬ì—ì´í‹°ë¸Œ |
| 10 | `getAllCreatives()` | 1946 | ì „ì²´ í¬ë¦¬ì—ì´í‹°ë¸Œ |

#### ê³µí†µ ìˆ˜ì • íŒ¨í„´

**1ë‹¨ê³„: ë©”íƒ€ ì „í™˜ íƒ€ì… ì¡°íšŒ**
```javascript
let metaConversionType = 'purchase';
if (advertiserId && advertiserId !== 'all') {
  const { data: advertiserData } = await supabase
    .from('advertisers')
    .select('meta_conversion_type')
    .eq('id', advertiserId)
    .single();
  metaConversionType = advertiserData?.meta_conversion_type || 'purchase';
}
```

**2ë‹¨ê³„: ì¿¼ë¦¬ í•„ë“œ ì¶”ê°€**
```javascript
.select('source, conversions, conversion_value, complete_registrations, complete_registrations_value, ...')
```

**3ë‹¨ê³„: ì§‘ê³„ ì‹œ ë§¤ì²´ë³„ ë¶„ê¸°**
```javascript
let conversions = 0;
let conversionValue = 0;

if (row.source === 'Meta') {
  // ë©”íƒ€ ê´‘ê³ : ì„¤ì •ì— ë”°ë¼ ë¶„ê¸°
  if (metaConversionType === 'complete_registration') {
    conversions = Number(row.complete_registrations) || 0;
    conversionValue = Number(row.complete_registrations_value) || 0;
  } else {
    conversions = Number(row.conversions) || 0;
    conversionValue = Number(row.conversion_value) || 0;
  }
} else {
  // ë‹¤ë¥¸ ë§¤ì²´: í•­ìƒ conversions ì‚¬ìš©
  conversions = Number(row.conversions) || 0;
  conversionValue = Number(row.conversion_value) || 0;
}
```

**ê²°ê³¼**: âœ… 10ê°œ í•¨ìˆ˜ ëª¨ë‘ ìˆ˜ì • ì™„ë£Œ

---

### 4. Demographics ì»´í¬ë„ŒíŠ¸ ìˆ˜ì • (2ê°œ)

#### ìˆ˜ì • íŒŒì¼
1. **[GenderPurchasePie.js](src/views/admin/default/components/GenderPurchasePie.js)**
   - ì„±ë³„ êµ¬ë§¤ ë¶„ì„ ì°¨íŠ¸

2. **[AgeGenderPurchase.js](src/views/admin/default/components/AgeGenderPurchase.js)**
   - ì—°ë ¹ëŒ€ë³„ ì„±ë³„ êµ¬ë§¤ ë¶„ì„

#### ìˆ˜ì • ë‚´ìš©
- `ad_performance_demographics` í…Œì´ë¸” ì¡°íšŒ ì‹œ `complete_registrations` í•„ë“œ ì¶”ê°€
- ë©”íƒ€ ì „í™˜ íƒ€ì… ì¡°íšŒ ë¡œì§ ì¶”ê°€
- ì§‘ê³„ ì‹œ ë§¤ì²´ë³„ ë¶„ê¸° ì²˜ë¦¬

**ì˜ˆì‹œ ì½”ë“œ**:
```javascript
const { data, error } = await supabase
  .from('ad_performance_demographics')
  .select('gender, source, conversions, complete_registrations')
  .in('advertiser_id', advertiserIds)
  .gte('date', startDate)
  .lte('date', endDate);

(data || []).forEach(row => {
  let conv = 0;
  if (row.source === 'Meta') {
    conv = metaConversionType === 'complete_registration'
      ? parseFloat(row.complete_registrations) || 0
      : parseFloat(row.conversions) || 0;
  } else {
    conv = parseFloat(row.conversions) || 0;
  }
  // ì§‘ê³„ ë¡œì§...
});
```

**ê²°ê³¼**: âœ… 2ê°œ ì»´í¬ë„ŒíŠ¸ ëª¨ë‘ ìˆ˜ì • ì™„ë£Œ

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: íšŒì›ê°€ì… ì „í™˜ ì„¤ì •

**ì‚¬ì „ ì¡°ê±´**: ê´‘ê³ ì£¼ `d4c9fb55-f23b-48c0-ba25-3f862ad86042`

**ë°ì´í„° í˜„í™©**:
- conversions: 0
- complete_registrations: 64

**í…ŒìŠ¤íŠ¸ ì ˆì°¨**:
1. `/superadmin/advertisers` ì ‘ì†
2. í•´ë‹¹ ê´‘ê³ ì£¼ "ì •ë³´ ìˆ˜ì •" í´ë¦­
3. ë©”íƒ€ ì „í™˜ ì„¤ì • â†’ "íšŒì›ê°€ì… (ë“±ë¡ì™„ë£Œ)" ì„ íƒ
4. ì €ì¥
5. `/admin/default` ì ‘ì† í›„ í•´ë‹¹ ê´‘ê³ ì£¼ ì„ íƒ
6. KPI ì „í™˜ìˆ˜ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼**: âœ… ì „í™˜ìˆ˜ = **64ê±´** (ì´ì „ 0ê±´)

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë§¤ì²´ê°„ í•©ì‚° í™•ì¸

**ê°€ì •**:
- ë©”íƒ€(íšŒì›ê°€ì… ì„¤ì •): 64ê±´
- êµ¬ê¸€: 30ê±´
- ë„¤ì´ë²„: 20ê±´

**ì˜ˆìƒ ê²°ê³¼**: âœ… ì´ ì „í™˜ìˆ˜ = **114ê±´**

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### ì‹ ê·œ ìƒì„±
1. `database/migrations/add_meta_conversion_type.sql`

### ìˆ˜ì •
2. `src/views/superadmin/advertisers/index.jsx`
3. `src/views/superadmin/advertisers/components/EditBrandModal.jsx`
4. `src/services/supabaseService.js` (10ê°œ í•¨ìˆ˜)
5. `src/views/admin/default/components/GenderPurchasePie.js`
6. `src/views/admin/default/components/AgeGenderPurchase.js`

**ì´ 6ê°œ íŒŒì¼ ìˆ˜ì •**

---

## ğŸ” ê²€ì¦ SQL

### ê´‘ê³ ì£¼ ì„¤ì • í™•ì¸
```sql
SELECT id, name, meta_conversion_type
FROM advertisers
WHERE id = 'd4c9fb55-f23b-48c0-ba25-3f862ad86042';
```

### ë©”íƒ€ ë°ì´í„° í™•ì¸
```sql
SELECT
  date,
  conversions,
  complete_registrations,
  conversion_value,
  complete_registrations_value
FROM ad_performance
WHERE advertiser_id = 'd4c9fb55-f23b-48c0-ba25-3f862ad86042'
  AND source = 'Meta'
  AND deleted_at IS NULL
ORDER BY date DESC
LIMIT 10;
```

---

## ğŸ’¡ ì£¼ìš” ê³ ë ¤ì‚¬í•­

### 1. ì „ì²´ ë¸Œëœë“œ ì¡°íšŒ ì‹œ
- `currentAdvertiserId === 'all'`ì¼ ë•ŒëŠ” ê¸°ë³¸ê°’(`purchase`) ì‚¬ìš©
- ë‹¨ì¼ ê´‘ê³ ì£¼ ì„ íƒ ì‹œì—ë§Œ ì„¤ì • ì ìš©

### 2. ì„±ëŠ¥ ì˜í–¥
- ê° ì„œë¹„ìŠ¤ í•¨ìˆ˜ì—ì„œ ê´‘ê³ ì£¼ ì„¤ì • ì¡°íšŒ 1íšŒ ì¶”ê°€
- í•„ìš” ì‹œ AuthContextì— ìºì‹± ê³ ë ¤ ê°€ëŠ¥

### 3. ì—ëŸ¬ ì²˜ë¦¬
- ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’(`purchase`) ë°˜í™˜
- ê¸°ì¡´ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ë„ë¡ ë°©ì–´ ë¡œì§ ì¶”ê°€

### 4. ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±
- ëª¨ë“  ê¸°ì¡´ ê´‘ê³ ì£¼ëŠ” `'purchase'`ë¡œ ì´ˆê¸°í™”
- íšŒì›ê°€ì… ì „í™˜ ì¶”ì  ê´‘ê³ ì£¼ëŠ” ìˆ˜ë™ ë³€ê²½ í•„ìš”

### 5. í–¥í›„ í™•ì¥ì„±
ìƒˆë¡œìš´ í…Œì´ë¸”ì´ ì¶”ê°€ë  ê²½ìš° ë™ì¼í•œ íŒ¨í„´ ì ìš©:
```javascript
// 1. ë©”íƒ€ ì „í™˜ íƒ€ì… ì¡°íšŒ
// 2. ì¿¼ë¦¬ì— complete_registrations í•„ë“œ ì¶”ê°€
// 3. if (row.source === 'Meta') ë¶„ê¸° ì²˜ë¦¬
```

---

## ğŸ“Š ë°ì´í„° íë¦„ë„

```
ì‚¬ìš©ì ì„¤ì • (/superadmin/advertisers)
    â†“
advertisers.meta_conversion_type ì €ì¥
    â†“
ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ë¡œë“œ
    â†“
ì„œë¹„ìŠ¤ í•¨ìˆ˜ í˜¸ì¶œ (getKPIData ë“±)
    â†“
ê´‘ê³ ì£¼ ì„¤ì • ì¡°íšŒ (meta_conversion_type)
    â†“
ad_performance ë°ì´í„° ì¡°íšŒ
    â†“
ë§¤ì²´ë³„ ë¶„ê¸° ì²˜ë¦¬
  â”œâ”€ Meta â†’ ì„¤ì •ê°’(complete_registrations or conversions)
  â””â”€ íƒ€ë§¤ì²´ â†’ conversions
    â†“
ì§‘ê³„ ë° í•©ì‚°
    â†“
ì°¨íŠ¸/í…Œì´ë¸” ë Œë”ë§
```

---

## ğŸ¯ ê²°ë¡ 

ë©”íƒ€ ê´‘ê³ ì˜ ì „í™˜ ì§€í‘œë¥¼ ê´‘ê³ ì£¼ë³„ë¡œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ ì™„ë£Œ:
- âœ… DB ë§ˆì´ê·¸ë ˆì´ì…˜
- âœ… ê´‘ê³ ì£¼ ì„¤ì • UI
- âœ… ì„œë¹„ìŠ¤ í•¨ìˆ˜ 10ê°œ ìˆ˜ì •
- âœ… Demographics ì»´í¬ë„ŒíŠ¸ 2ê°œ ìˆ˜ì •
- âœ… ì´ 6ê°œ íŒŒì¼ ìˆ˜ì •

íšŒì›ê°€ì…ì„ ì „í™˜ìœ¼ë¡œ ì¶”ì í•˜ëŠ” ê´‘ê³ ì£¼ë„ ì´ì œ ëŒ€ì‹œë³´ë“œì—ì„œ ì •í™•í•œ ì „í™˜ìˆ˜(complete_registrations)ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“ ì›ë³¸ í”Œëœ íŒŒì¼

ì›ë³¸ í”Œëœ: `C:\Users\REON\.claude\plans\jiggly-painting-lampson.md`
